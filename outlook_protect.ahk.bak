#Persistent
#SingleInstance, Force
Menu, Tray, Icon, mail-queue-2.ico


SetTimer, OutlookProtect, 50

OutlookProtect:
	;outlook protection
	;   ahk_class rctrl_renwnd32
	;   ahk_exe OUTLOOK.EXE
	;       ClassNN:	_WwG1
	;       Text:	Message
	WinGet, winID, ID, A
	if (winID = oldwinID)
	{
		return
	}
	WinGetClass, winClass, A
	WinGet, winProcessName, ProcessName, A
	;msgbox % winClass
	if (winClass ="rctrl_renwnd32")
	{
		ControlGetText, control_text, Button1, ahk_id %winID%
		;msgbox % winID
		;msgbox % control_text
		if (control_text = "&Send")
		{
			Control, Disable,, Button1, ahk_id %winID%
		}
	}
	if (winClass ="#32770" and WinProcessName = "OUTLOOK.EXE")
	{
		ControlGetText, winVerify, Static14, A
		if (winVerify = "Delivery options")
		{
			Random, randomMinute, 1, 9
			dayNumber := A_WDay
			msgbox % A_WDay
			Switch dayNumber
			{
				case 6:
					additionalDays	:= 3
				case 7:
					additionalDays	:= 2
				Default:	
					additionalDays := 1
			}
			currentTime := A_Now
			EnvAdd, currentTime, % additionalDays, Days
			futureTime := currentTime
			FormatTime, futureDate, % futureTime, M/d/yyyy
			deliveryTime := "5:3" randomMinute " AM"
			ControlSetText, RichEdit20WPT2, % futureDate, A
			ControlSetText, RichEdit20WPT3, % deliveryTime, A
		}
		
	}
	oldwinID := winID
return 

:*?:==send::
enable_send_button()
{
  global
  WinGet, winID, ID, A
  WinGetClass, winClass, A
  if (winClass ="rctrl_renwnd32")
  {
    ControlGetText, control_text, Button1, ahk_id %winID%
    ;msgbox % winID
    ;msgbox % control_text
    if (control_text = "&Send")
    {
      SetTimer, OutlookProtect, Off
      Control, Enable,, Button1, ahk_id %winID%
      Sleep, 250 ; give message window time to respond/delete hotstring text.
      ControlFocus, Button1, ahk_id %winID%
      Sleep, 5000
      Control, Disable,, Button1, ahk_id %winID%
      ControlFocus, _WwG1, ahk_id %winID%
      SetTimer, OutlookProtect, 50
    }
  }
}

:*?:==draft::
save_draft_and_close()
{
  global
  WinGet, winID, ID, A
  WinGetClass, winClass, A
  if (winClass ="rctrl_renwnd32")
  {
    Send, ^s
	Sleep, 1000
	WinClose, ahk_id %winID%
  }
}